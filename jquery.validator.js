/*! nice Validator 0.7.0
 * (c) 2012-2014 Jony Zhang <zj86@live.cn>, MIT Licensed
 * http://niceue.com/validator/
 */
!function(e,t){"use strict";function i(s,r){var n=this;return!n instanceof i?new i(s,r):(n.$el=e(s),n._init(s,r),t)}function s(e,t){var i=t?t===!0?this:t:s.prototype;if(H(e))for(var r in e)i[r]=n(e[r])}function r(e,t){var i=t?t===!0?this:t:r.prototype;if(H(e))for(var s in e){if(!e[s])return;i[s]=e[s]}}function n(t){switch(e.type(t)){case"function":return t;case"array":return function(e){return t[0].test(e.value)||t[1]||!1};case"regexp":return function(e){return t.test(e.value)}}}function a(t){var i="";return e.map(t.split(" "),function(e){i+=","+("#"===e.charAt(0)?e:'[name="'+e+'"]')}),i.substring(1)}function l(t){var i;if(t&&t.tagName){switch(t.tagName){case"INPUT":case"SELECT":case"TEXTAREA":case"BUTTON":case"FIELDSET":i=t.form||e(t).closest(".n-"+p);break;case"FORM":i=t;break;default:i=e(t).closest(".n-"+p)}return e(i).data(p)||e(i)[p]().data(p)}}function u(t,i){if(t.form&&null===P(t.form,C)){var s=l(t);s?(s._parse(t),e(t).trigger(i)):P(t,M,null)}}function o(i,s){var r=e.trim(P(i,M+"-"+s));if(r)return r=Function("return "+r)(),r?n(r):t}function d(e,t,i){var s=t.msg;return H(s)&&i&&(s=s[i]),U(s)||(s=P(e,"data-msg-"+i)||P(e,"data-msg")||""),s}function f(e){var t;return e&&(t=S.exec(e)),t?t[1]:""}function c(e){return"INPUT"===e.tagName&&"checkbox"===e.type||"radio"===e.type}function g(e){return Date.parse(e.replace(/\.|\-/g,"/"))}var h,p="validator",m="n-ok",v="n-error",_="n-tip",y="n-loading",b="msg-box",k="aria-required",w="aria-invalid",M="data-rule",O="data-target",x="data-tip",$="data-inputstatus",C="novalidate",V=":verifiable",F=/(!?)\s?(\w+)(?:\[\s*(.*?\]?)\s*\]|\(\s*(.*?\)?)\s*\))?\s*(;|\||&)?/g,A=/(\w+)(?:\[\s*(.*?\]?)\s*\]|\(\s*(.*?\)?)\s*\))?/,T=/(?:([^:;\(\[]*):)?(.*)/,R=/[^\x00-\xff]/g,S=/^.*(top|right|bottom|left).*$/,E=/(?:(post|get):)?(.+)/i,q=/<|>/g,N=e.noop,j=e.proxy,D=e.isFunction,I=e.isArray,U=function(e){return"string"==typeof e},H=function(e){return e&&"[object Object]"===Object.prototype.toString.call(e)},L=!window.XMLHttpRequest,P=function(e,i,s){return s===t?e.getAttribute(i):(null===s?e.removeAttribute(i):e.setAttribute(i,""+s),t)},W=window.console||{log:N,info:N},B={debug:0,timely:1,theme:"default",ignore:"",focusInvalid:!0,validClass:"n-valid",invalidClass:"n-invalid",msgWrapper:"span",msgMaker:function(e){var t,i={error:v,ok:m,tip:_,loading:y}[e.type];return t='<span class="msg-wrap '+i+'" role="alert">',t+=(e.arrow||"")+(e.icon||"")+'<span class="n-msg">'+e.msg+"</span>",t+="</span>"},msgIcon:'<span class="n-icon"></span>',msgArrow:"",msgClass:"",defaultMsg:"{0} is not valid.",loadingMsg:"Validating..."},X={"default":{formClass:"n-default",msgClass:"n-right",showOk:""}};e.fn[p]=function(t){var s=this,r=arguments;return s.is(":input")?s:(!s.is("form")&&(s=this.find("form")),!s.length&&(s=this),s.each(function(){var s=e(this).data(p);if(s)if(U(t)){if("_"===t.charAt(0))return;s[t].apply(s,Array.prototype.slice.call(r,1))}else t&&(s._reset(!0),s._init(this,t));else new i(this,t)}),this)},e.fn.isValid=function(e,i){var s,r,n=l(this[0]);return n?(i===t&&(i=!0),n.checkOnly=i,s=this.is(":input")?this:this.find(V),r=n._multiValidate(s,function(t){D(e)&&e.call(null,t),n.checkOnly=!1}),D(e)?this:r):!0},e.expr[":"].verifiable=function(e){var t=e.nodeName.toLowerCase();return("input"===t&&!{submit:1,button:1,reset:1,image:1}[e.type]||"select"===t||"textarea"===t)&&e.disabled===!1&&null===P(e,C)},i.prototype={_init:function(i,n){var l,u,o,d=this;if(D(n)&&(n={valid:n}),n=n||{},o=P(i,"data-"+p+"-option"),o=o&&"{"===o.charAt(0)?Function("return "+o)():{},u=X[n.theme||o.theme||B.theme],l=d.options=e.extend({},B,u,o,this.options,n),d.rules=new s(l.rules,!0),d.messages=new r(l.messages,!0),d.elements=d.elements||{},d.deferred={},d.errors={},d.fields={},d._initFields(l.fields),I(l.groups)&&e.map(l.groups,function(i){return U(i.fields)&&D(i.callback)?(i.$elems=d.$el.find(a(i.fields)),e.map(i.fields.split(" "),function(e){d.fields[e]=d.fields[e]||{},d.fields[e].group=i}),t):null}),d.msgOpt={type:"error",pos:f(l.msgClass),wrapper:l.msgWrapper,cls:l.msgClass,style:l.msgStyle,icon:l.msgIcon,arrow:l.msgArrow,show:l.msgShow,hide:l.msgHide},d.isAjaxSubmit=!1,l.valid||null===P(i,"action"))d.isAjaxSubmit=!0;else{var c=e[e._data?"_data":"data"](i,"events");c&&c.valid&&e.map(c.valid,function(e){return-1!==e.namespace.indexOf("form")?1:null}).length&&(d.isAjaxSubmit=!0)}d.$el.data(p)||(d.$el.data(p,d).addClass("n-"+p+" "+l.formClass).on("submit."+p+" validate."+p,j(d,"_submit")).on("reset."+p,j(d,"_reset")).on("showtip."+p,j(d,"_showTip")).on("validated.field."+p,V,j(d,"_validatedField")).on("validated.rule."+p,V,j(d,"_validatedRule")).on("focusin."+p+" click."+p+" showtip."+p,V,j(d,"_focus")).on("focusout."+p+" validate."+p,V,j(d,"_blur")).on("click."+p,":radio,:checkbox",j(d,"_click")),l.timely>=2&&d.$el.on("keyup."+p+" paste."+p,V,j(d,"_blur")).on("change."+p,"select",j(d,"_click")),d._novalidate=P(i,C),P(i,C,C))},_initFields:function(t){var i=this;H(t)&&e.each(t,function(e,t){if(null===t){var s=i.elements[e];s&&i._resetElement(s,!0),delete i.fields[e]}else i.fields[e]=U(t)?{rule:t}:t}),i.$el.find(V).each(function(){i._parse(this)})},_parse:function(e){var t,i=this,s=e.name,r=P(e,M);r&&P(e,M,null),(e.id&&"#"+e.id in i.fields||!e.name)&&(s="#"+e.id),s&&(t=i.fields[s]||{},t.key=s,t.old={},t.rule=t.rule||r||"",t.rule&&(t.rule.match(/match|checked/)&&(t.must=!0),-1!==t.rule.indexOf("required")&&(t.required=!0,P(e,k,!0)),("timely"in t&&!t.timely||!i.options.timely)&&P(e,"notimely",!0),U(t.target)&&P(e,O,t.target),U(t.tip)&&P(e,x,t.tip),i.fields[s]=i._parseRule(t)))},_parseRule:function(e){var i=T.exec(e.rule);if(i)return e._v=0,e.display=i[1],i[2]&&(e.rules=[],i[2].replace(F,function(){var i=arguments;i[3]=i[3]||i[4],e.rules.push({not:"!"===i[1],method:i[2],params:i[3]?i[3].split(", "):t,or:"|"===i[5]})})),e},_multiValidate:function(i,s){var r=this,n=r.options;return r._multiValid=!0,n.ignore&&(i=i.not(n.ignore)),i.each(function(e,i){var s=r.getField(i);if(s)return r._validate(i,s),!r._multiValid&&n.stopOnError?!1:t}),e.when.apply(null,e.map(r.deferred,function(e){return e})).done(function(){s.call(r,r._multiValid)}),e.isEmptyObject(r.deferred)?r._multiValid:t},_submit:function(i,s){var r=this,n=r.options,a=i.target;if(h)return h=!1,t;if("only"!==s&&("validate"!==i.type||r.$el[0]===a)){if(i.preventDefault(),r.submiting)return D(r.submiting)&&r.submiting.call(r),t;if(!D(n.beforeSubmit)||n.beforeSubmit.call(r,a)!==!1){n.debug&&W.log("\n"+i.type+" form");var l="submit"===i.type;r._reset(),r.submiting=!0,r.isValid=t,r._multiValidate(r.$el.find(V),function(t){var i,s=t||2===n.debug?"valid":"invalid";t||(n.focusInvalid&&r.$el.find(":input["+w+'="true"]:first').trigger("focus.field"),i=e.map(r.errors,function(e){return e})),r.submiting=!1,D(n[s])&&n[s].call(r,a,i),r.$el.trigger(s+".form",[a,i]),t&&!r.isAjaxSubmit&&l&&(h=!0,a.submit())})}}},_reset:function(e){var t=this;t.errors={},e&&t.$el.find(V).each(function(e,i){t._resetElement(i)})},_resetElement:function(t,i){var s=this.options;e(t).removeClass(s.validClass+" "+s.invalidClass),this.hideMsg(t),i&&P(t,k,null)},_focus:function(t){var i,s=this,r=s.options,n=t.target;if("showtip"!==t.type){if(t.isTrigger||s.submiting)return;if("error"===P(n,$))r.focusCleanup&&(e(n).removeClass(r.invalidClass),s.hideMsg(n));else if(""!==n.value)return}i=P(n,x),i&&s.showMsg(n,{msg:i,type:"tip"})},_blur:function(t,i){var s,r,n=this,a=n.options,l=t.target,u=t.type,o=150;if(!i&&"paste"!==u){if("validate"===u)r=!0,o=0;else{if(P(l,"notimely"))return;if(a.timely>=2&&"keyup"!==u)return}if(a.ignore&&e(l).is(a.ignore))return;if("keyup"===u){var d=t.keyCode,f={8:1,9:1,16:1,32:1,46:1};if(9===d&&!l.value)return;if(48>d&&!f[d])return;o=a.timely>=100?a.timely:500}}s=n.getField(l),s&&(o?(s._t&&clearTimeout(s._t),s._t=setTimeout(function(){n._validate(l,s,r)},o)):n._validate(l,s,r))},_click:function(e){this._blur(e,!0)},_showTip:function(e){var t=this;t.$el[0]===e.target&&t.$el.find(V+"["+x+"]").each(function(){t.showMsg(this,{msg:P(this,x),type:"tip"})})},_validatedField:function(t,i,s){var r=this,n=r.options,a=t.target,l=s.isValid=i.isValid=!!s.isValid,u=l?"valid":"invalid";s.key=i.key,s.rule=i._r,l?s.type="ok":(r.submiting&&(r.errors[i.key]=s.msg),r._multiValid=!1),i.old.value=a.value,i.old.id=a.id,r.elements[i.key]=a,r.$el[0].isValid=r.isValid=l?r.isFormValid():l,r.checkOnly||(D(i[u])&&i[u].call(r,a,s),e(a).attr(w,l?null:!0).removeClass(l?n.invalidClass:n.validClass).addClass(s.skip?"":l?n.validClass:n.invalidClass).trigger(u+".field",[s,r]),r.$el.triggerHandler("validation",[s,r]),(i.msgMaker||n.msgMaker)&&(!s.showOk&&s.msg||s.showOk&&n.showOk!==!1?r.showMsg(a,s,i):r.hideMsg(a,s,i)))},_validatedRule:function(i,s,r,n){var a,l,u,o=this,f=o.options,c=i.target,g="",h=!1,p=!1;if(n=n||{},s=s||o.getField(c),l=s._r,null===r)return e(c).trigger("validated.field",[s,{isValid:!0,skip:!0}]),t;if(r===!0||r===t?h=!0:(g=d(c,s,l),g||(U(r)?(g=r,r={error:g}):H(r)&&(r.error?g=r.error:(h=!0,r.ok&&U(r.ok)&&(p=!0),g=r.ok))),n.msg=(h?g:g||o.messages[l]||B.defaultMsg).replace("{0}",s.display||"")),s.rules&&(a=s.rules[s._v],a.not&&(h="required"===l||!h),a.or))if(h)for(;s.rules[s._v++].or&&s._v!==s.rules.length;);else u=!0;if(f.debug&&W.log("   "+s._v+": "+l+" => "+(n.msg||!0)),!u)if(h){if(n.isValid=!0,!p){var m=s.ok||P(c,"data-ok");m?(p=!0,n.msg=m):U(f.showOk)&&(p=!0,n.msg=f.showOk)}n.showOk=p,e(c).trigger("valid.rule",[l,n.msg])}else e(c).trigger("invalid.rule",[l,n.msg]);u||h&&s._v<s.rules.length-1?(s._v++,o._checkRule(c,s)):(s._v=0,e(c).trigger("validated.field",[s,n]))},_checkRule:function(i,s){var r,n,a=this,l=s.key,u=s.rules[s._v],f=u.method,c=u.params;if(!a.submiting||!a.deferred[l]){if(n=s.old,s._r=f,!s.must&&n.ret!==t&&n.rule===u&&n.id===i.id&&i.value&&n.value===i.value)r=n.ret;else{var g=o(i,f)||a.rules[f];r=g?g.call(a,i,c,s):d(i,s,f)||a.messages[f]}if(H(r)&&D(r.then)){var h=function(e){return U(e)||H(e)&&("error"in e||"ok"in e)?e:t};a.deferred[l]=r,!a.checkOnly&&a.showMsg(i,{type:"loading",msg:a.options.loadingMsg},s),r.then(function(r,l,o){var d,f=o.responseText,c=s.dataFilter||a.options.dataFilter;"json"===this.dataType?f=r:"{"===f.charAt(0)&&(f=e.parseJSON(f)||{}),D(c)?f=c(f):""===f?f=!0:(d=h(f),d===t&&(d=h(f.data)),f=d||!0),n.rule=u,n.ret=f,e(i).trigger("validated.rule",[s,f])},function(t,r){e(i).trigger("validated.rule",[s,r])}).always(function(){delete a.deferred[l]}),s.isValid=t}else e(i).trigger("validated.rule",[s,r])}},_validate:function(i,s){if(!i.disabled&&null===P(i,C)){s.rules||this._parse(i);var r,n=this,a=n.options,l=e(i),u={},o=s.group,d=s.isValid=!0;if(a.debug&&W.info(s.key),o&&(r=o.callback.call(n,o.$elems),r!==t&&(n.hideMsg(o.target,{},s),r===!0?r=t:(U(r)&&(r={error:r}),s._v=0,s._r="group",d=!1,n.hideMsg(i,{},s),e.extend(u,o)))),d&&!s.required&&!s.must&&!i.value){if("tip"===P(i,$))return;if(!c(i))return l.trigger("validated.field",[s,{isValid:!0}]),t}r!==t?l.trigger("validated.rule",[s,r,u]):s.rule&&n._checkRule(i,s)}},test:function(e,i){var s,r,n,a=this,l=A.exec(i);return l&&(r=l[1],r in a.rules&&(n=l[2]||l[3],n=n?n.split(", "):t,s=a.rules[r].call(a,e,n))),s===!0||s===t||null===s||!1},getRangeMsg:function(e,t,i,s){if(t){var r=this,n=r.messages[i]||"",a=t[0].split("~"),l=a[0],u=a[1],o="rg",d=[""],f=+e===+e;if(2===a.length){if(l&&u){if(f&&e>=+l&&+u>=e)return!0;d=d.concat(a)}else if(l&&!u){if(f&&e>=+l)return!0;d.push(l),o="gt"}else if(!l&&u){if(f&&+u>=e)return!0;d.push(u),o="lt"}}else{if(e===+l)return!0;d.push(l),o="eq"}return n&&(s&&n[o+s]&&(o+=s),d[0]=n[o]),r.renderMsg.apply(null,d)}},renderMsg:function(){var e=arguments,t=e[0],i=e.length;if(t){for(;--i;)t=t.replace("{"+i+"}",e[i]);return t}},_getMsgOpt:function(t){return e.extend({},this.msgOpt,U(t)?{msg:t}:t)},_getMsgDOM:function(t,i){var s,r,n,a=e(t);if(a.is(":input")?(n=i.target||P(t,O),n&&(n=this.$el.find(n),n.length&&(n.is(":input")?t=n.get(0):s=n)),s||(r=!c(t)&&t.id?t.id:t.name,s=this.$el.find(i.wrapper+"."+b+'[for="'+r+'"]'))):s=a,!s.length)if(a=this.$el.find(n||t),s=e("<"+i.wrapper+">").attr({"class":b+(i.cls?" "+i.cls:""),style:i.style||"","for":r}),c(t)){var l=a.parent();s.appendTo(l.is("label")?l.parent():l)}else s[i.pos&&"right"!==i.pos?"insertBefore":"insertAfter"](a);return s},showMsg:function(t,i,s){if(i=this._getMsgOpt(i),i.msg||i.showOk){t=e(t).get(0),e(t).is(V)&&(P(t,$,i.type),s=s||this.getField(t),s&&(i.style=s.msgStyle||i.style,i.cls=s.msgClass||i.cls,i.wrapper=s.msgWrapper||i.wrapper));var r=this._getMsgDOM(t,i),n=r[0].className;!S.test(n)&&r.addClass(i.cls),L&&"bottom"===i.pos&&(r[0].style.marginTop=e(t).outerHeight()+"px"),r.html(((s||{}).msgMaker||this.options.msgMaker).call(this,i)),r[0].style.display="",D(i.show)&&i.show.call(this,r,i.type)}},hideMsg:function(t,i,s){t=e(t).get(0),i=this._getMsgOpt(i),e(t).is(V)&&(P(t,$,null),P(t,w,null),s=s||this.getField(t),s&&(i.wrapper=s.msgWrapper||i.wrapper));var r=this._getMsgDOM(t,i);r.length&&(D(i.hide)?i.hide.call(this,r,i.type):r[0].style.display="none")},mapMsg:function(t){var i=this;e.each(t,function(e,t){var s=i.elements[e]||i.$el.find(':input[name="'+e+'"]')[0];i.showMsg(s,t)})},setMsg:function(e){new r(e,this.messages)},setRule:function(t){new s(t,this.rules),e.map(this.fields,function(e){e.old={}})},getField:function(e){var t,i=this;return t=e.id&&"#"+e.id in i.fields||!e.name?"#"+e.id:e.name,P(e,M)&&i._parse(e),i.fields[t]},setField:function(e,t){var i={};U(e)?i[e]=t:H(e)&&(i=e),this._initFields(i)},isFormValid:function(){var e=this.fields;for(var t in e)if(!e[t].isValid)return e[t].isValid;return!0},holdSubmit:function(e){this.submiting=e===t||e},cleanUp:function(){this._reset(1)},destroy:function(){this._reset(1),this.$el.off("."+p).removeData(p),P(this.$el[0],C,this._novalidate)}},e(document).on("focusin",":input["+M+"]",function(){u(this,"focusin")}).on("click","input,button",function(){if(this.form)if("submit"===this.type)null!==P(this,C)&&(h=!0);else if(this.name&&c(this)){var e=this.form.elements[this.name];e.length&&(e=e[0]),P(e,M)&&u(e,"validate")}}).on("submit validate","form",function(t){if(null===P(this,C)){var i,s=e(this);s.data(p)||(i=s[p]().data(p),e.isEmptyObject(i.fields)?(P(this,C,C),s.off("."+p).removeData(p)):i._submit(t))}}),new s({required:function(t,i){var s=e.trim(t.value),r=!0;if(i)if(1===i.length){if(!s&&!this.test(t,i[0]))return P(t,k,null),null;P(t,k,!0)}else"not"===i[0]&&e.map(i.slice(1),function(t){s===e.trim(t)&&(r=!1)});return r&&!!s},integer:function(e,t){var i,s="0|",r="[1-9]\\d*",n=t?t[0]:"*";switch(n){case"+":i=r;break;case"-":i="-"+r;break;case"+0":i=s+r;break;case"-0":i=s+"-"+r;break;default:i=s+"-?"+r}return i="^(?:"+i+")$",RegExp(i).test(e.value)||this.messages.integer[n]},match:function(t,i,s){if(i){var r,n,a,l,u,o,d,f="eq";if(1===i.length?a=i[0]:(f=i[0],a=i[1]),u="#"===a.charAt(0)?a:':input[name="'+a+'"]',o=this.$el.find(u)[0]){if(d=this.getField(o),r=t.value,n=o.value,s.init_match||(this.$el.on("valid.field."+p,u,function(){e(t).trigger("validate")}),s.init_match=d.init_match=1),!s.required&&""===r&&""===n)return null;if(i[2]&&("date"===i[2]?(r=g(r),n=g(n)):"time"===i[2]&&(r=+r.replace(":",""),n=+n.replace(":",""))),"eq"!==f&&!isNaN(+r)&&isNaN(+n))return!0;switch(l=this.messages.match[f].replace("{1}",d.display||a),f){case"lt":return+n>+r||l;case"lte":return+n>=+r||l;case"gte":return+r>=+n||l;case"gt":return+r>+n||l;case"neq":return r!==n||l;default:return r===n||l}}}},range:function(e,t){return this.getRangeMsg(+e.value,t,"range")},checked:function(t,i,s){if(c(t)){var r,n;return n=this.$el.find('input[name="'+t.name+'"]').filter(function(){return!r&&c(this)&&(r=this),!this.disabled&&this.checked&&e(this).is(":visible")}).length,i?this.getRangeMsg(n,i,"checked"):!!n||d(r,s,"checked")||this.messages.required}},length:function(e,t){if(t){var i=e.value,s=(t[1]?i.replace(R,"xx"):i).length;return"~"===t[0].charAt(0)&&(t[0]="0"+t[0]),this.getRangeMsg(s,t,"length",t[1]?"_2":"")}},remote:function(t,i){if(i){var s,r=this,n=E.exec(i[0]),a=n[2],l=(n[1]||"POST").toUpperCase(),u={};return u[t.name]=t.value,i[1]&&e.map(i.slice(1),function(t){u[e.trim(t)]=r.$el.find(':input[name="'+t+'"]').val()}),u=e.param(u),"POST"===l&&(s=a.indexOf("?"),-1!==s&&(u+="&"+a.substring(s+1,a.length),a=a.substring(0,s))),e.ajax({url:a,type:l,data:u,async:!0,cache:!1})}},filter:function(e,t){e.value=e.value.replace(t?RegExp("["+t[0]+"]","gm"):q,"")}}),i.config=function(t){e.each(t,function(e,t){"rules"===e?new s(t):"messages"===e?new r(t):B[e]=t})},i.setTheme=function(t,i){H(t)?e.each(t,function(e,t){X[e]=t}):U(t)&&H(i)&&(X[t]=i)},e[p]=i}(jQuery);
